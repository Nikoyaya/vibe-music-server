<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.amis.vibemusicserver.mapper.SongMapper">

    <!-- 基本结果映射 -->
    <resultMap id="SongVOResultMap" type="org.amis.vibemusicserver.model.vo.SongVO">
        <id property="songId" column="songId"/>
        <result property="songName" column="songName"/>
        <result property="album" column="album"/>
        <result property="duration" column="duration"/>
        <result property="coverUrl" column="coverUrl"/>
        <result property="audioUrl" column="audioUrl"/>
        <result property="releaseTime" column="releaseTime"/>
        <result property="artistName" column="artistName"/>
    </resultMap>

    <!-- 根据歌曲名称、艺术家和专辑获取歌曲列表 -->
    <select id="getSongsWithArtist" resultMap="SongVOResultMap">
        SELECT
            s.id AS songId,
            s.name AS songName,
            s.album,
            s.duration,
            s.cover_url AS coverUrl,
            s.audio_url AS audioUrl,
            s.release_time AS releaseTime,
            a.name AS artistName
        FROM tb_song s
        LEFT JOIN tb_artist a ON s.artist_id = a.id
        WHERE
            (#{songName} IS NULL OR s.name LIKE CONCAT('%', #{songName}, '%'))
            AND (#{artistName} IS NULL OR a.name LIKE CONCAT('%', #{artistName}, '%'))
            AND (#{album} IS NULL OR s.album LIKE CONCAT('%', #{album}, '%'))
    </select>

    <!-- 管理员视图的歌曲列表 -->
    <resultMap id="SongAdminVOResultMap" type="org.amis.vibemusicserver.model.vo.SongAdminVO">
        <id property="songId" column="songId"/>
        <result property="songName" column="songName"/>
        <result property="album" column="album"/>
        <result property="lyric" column="lyric"/>
        <result property="duration" column="duration"/>
        <result property="style" column="style"/>
        <result property="coverUrl" column="coverUrl"/>
        <result property="audioUrl" column="audioUrl"/>
        <result property="releaseTime" column="releaseTime"/>
        <result property="artistName" column="artistName"/>
    </resultMap>

    <select id="getSongsWithArtistName" resultMap="SongAdminVOResultMap">
        SELECT
            s.id AS songId,
            s.name AS songName,
            s.artist_id AS artistId,
            s.album,
            s.lyric,
            s.duration,
            s.style,
            s.cover_url AS coverUrl,
            s.audio_url AS audioUrl,
            s.release_time AS releaseTime,
            a.name AS artistName
        FROM tb_song s
        LEFT JOIN tb_artist a ON s.artist_id = a.id
        WHERE
            (#{artistId} IS NULL OR s.artist_id = #{artistId})
            AND (#{songName} IS NULL OR s.name LIKE CONCAT('%', #{songName}, '%'))
            AND (#{album} IS NULL OR s.album LIKE CONCAT('%', #{album}, '%'))
        ORDER BY s.release_time DESC
    </select>

</mapper>